function ChartGeneration(c){ChartGeneration.eventHandlers={toggleSeries:function(E,G,C,B){if(G===undefined||G<0){return}var F=ChartGeneration.data[G].charts[C];var D=F.series[B];var A=false;if(D._show===false){A=true}D._show=A;if(!D.lines){D.lines={show:true}}D.lines.show=A?D._showLines:false;if(!D.bars){D.bars={show:false}}D.bars.show=A?D._showBars:false;if(!D.points){D.points={show:false}}D.points.show=A?D._showPoints:false;s(F.plot.getPlaceholder(),F.plot,F,true)}};ChartGeneration.data=[];ChartGeneration.compositeReport={};function k(A){var B=ChartGeneration.data;if(A>=B.length){return}B[A]._index=A;o(c(".report"),B[A])}function o(G,A){G.children(".report_title").text(A.title);var F=G.children(".charts");var E=A.charts;F.html("");for(var C=0;C<E.length;++C){var D=E[C];var B=c("<div class='chart'/>");F.append(B);D._index=C;D._reportIndex=A._index;if(D.chartType==="JmeterSummaryChart"){b(B,D)}else{if(D.chartType==="TABLE"){y(B,D)}else{if(D.xaxisMode==="BAR_STRING"){z(B,D)}else{p(B,D)}}}}}function y(G,H){G.append(c("<h3 class='chart_title'/>").text(H.title)).append(c("<h4 class='chart_subtitle'/>").text(H.subtitle));var E=c("<div class='chart_table_container'>").appendTo(G);var L=c("<table class='chart_table'/>").appendTo(E);if(H.key){L.attr("data-key",H.key)}if(H.header){var A=c("<tr/>").appendTo(c("<thead/>").appendTo(L));for(var D=0;D<H.header.length;++D){c("<th/>").text(H.header[D]).appendTo(A)}}if(H.topRows){var F=c('<tbody class="tablesorter-no-sort"/>').appendTo(L);for(var D=0;D<H.topRows.length;++D){var J=c("<tr/>").appendTo(F);var M=H.topRows[D];for(var C=0;C<M.length;++C){var K=M[C];l(M[C]).appendTo(J)}}}if(H.rows){var B=c("<tbody/>").appendTo(L);for(var D=0;D<H.rows.length;++D){var J=c("<tr/>").appendTo(B);var M=H.rows[D];for(var C=0;C<M.length;++C){var K=M[C];l(M[C]).appendTo(J)}}}if(H.bottomRows){var I=c('<tbody class="tablesorter-no-sort"/>').appendTo(L);for(var D=0;D<H.bottomRows.length;++D){var J=c("<tr/>").appendTo(I);var M=H.bottomRows[D];for(var C=0;C<M.length;++C){var K=M[C];l(M[C]).appendTo(J)}}}L.tablesorter({cssInfoBlock:"tablesorter-no-sort"}).stickyTableHeaders({scrollableArea:E})}function l(B){var A=B.valueType==="double"||B.valueType==="float";var D=A||typeof B.value==="number"||B.valueType==="int"||B.valueType==="long";var C=B.value;if(A){C=B.value!==null?B.value.toFixed(3):(B.rawValue==="NaN"?"N/A":B.rawValue)}var E=c("<td/>").text(C);if(B.cssClass){E.addClass(B.cssClass)}if(D){E.css("text-align","right")}return E}function b(H,I){H.append(c("<h3 class='chart_title'/>").text(I.title)).append(c("<h4 class='chart_subtitle'/>").text(I.subtitle));var K=c("<table class='chart_table JmeterSummaryChart'/>").appendTo(H);var B=c("<tr/>").appendTo(c("<thead/>").appendTo(K));for(var F=0;F<I.columnLabels.length;++F){c("<th/>").text(I.columnLabels[F]).appendTo(B)}var E=c("<tbody/>").appendTo(K);for(var F=0;F<I.rows.length;++F){var J=c("<tr/>").appendTo(E);for(var D=0;D<I.rows[F].length;++D){var C=I.rows[F][D];var A=c("<td/>").text(C).appendTo(J);if(D>0){if(D===7&&C>0){A.addClass("JmeterSummaryChart_error")}else{if(D===2){var G=parseFloat(C);if(isNaN(G)||G>=5000){A.addClass("JmeterSummaryChart_error")}}}}}}K.tablesorter()}function i(C){if(!C._prepared){C._prepared=true;for(var B=0;B<C.series.length;++B){var A=C.series[B];A._index=B;A._chartIndex=C._index;A._reportIndex=C._reportIndex;A._showLines=A.lines&&A.lines.show===false?false:true;A._showBars=A.bars&&A.bars.show===true?true:false;A._showPoints=A.points&&A.points.show===true?true:false}}}function z(J,K){i(K);J.append(c("<h3 class='chart_title'/>").text(K.title)).append(c("<h4 class='chart_subtitle'/>").text(K.subtitle));var L=c("<div class='placeholder'/>").appendTo(J);c("<div class='x_label'/>").text(K.xLabel).appendTo(J);var E=c("<div class='legend'/>").appendTo(J);var I=g(L,E,K);j(L);var C=c("<div class='chart_controls_pad'/>").appendTo(J);var G=c("<ul class='chart_group_list' style='max-height:100px; overflow:scroll'/>").appendTo(C);for(var F in K.stringMap){var M=K.stringMap[F];var D=c("<li class='chart_bar_group_item'/>").appendTo(G);var H=c("<label/>").appendTo(D);var B=c("<input type='checkbox' class='cb_bar_group_selector' />").data("tag",{sid:F,chart:K}).prop("checked",K._groupShowBIT.get(F)).change(h).appendTo(H);c("<span/>").text(M).appendTo(H)}var A=c("<div class='chart_bar_show_hide_all' />").appendTo(C);c("<input type='button' value='clear selection' />").click(function(){c(".cb_bar_group_selector").prop("checked",false);K.series=[];K._groupShowBIT=new d(K.stringMapSize);s(I.getPlaceholder(),I,K,true)}).appendTo(A);c("<input type='button' value='select all' />").click(function(){c(".cb_bar_group_selector").prop("checked",true);K._groupShowBIT=new d(K.stringMapSize);for(var O=1;O<=K.stringMapSize;O++){K._groupShowBIT.update(O,1)}w(K,K.plot.getOptions());var N=I.getXAxes()[0].options;N._zoomed=false;N.min=I.getOptions().xaxis.min;N.max=I.getOptions().xaxis.max;s(I.getPlaceholder(),I,K,false)}).appendTo(A)}function h(G){var F=c(G.target);var D=F.is(":checked");var A=F.data("tag");var C=A.chart;var H=C._groupShowBIT;var E=C.plot;H.update(A.sid,D?1:-1);w(C,E.getOptions());var B=E.getXAxes()[0].options;B._zoomed=false;B.min=E.getOptions().xaxis.min;B.max=E.getOptions().xaxis.max;s(E.getPlaceholder(),E,C,false)}function d(A){this.N=A;this.data=new Array()}d.prototype={lowbit:function(A){return A&-A},update:function(A,B){A=Number.parseInt(A);while(A<=this.N){if(!this.data[A]){this.data[A]=B}else{this.data[A]+=B}A+=this.lowbit(A)}},getSum:function(A){A=Number.parseInt(A);var B=0;while(A>0){B+=this.data[A]?this.data[A]:0;A-=this.lowbit(A)}return B},get:function(A){return this.getSum(A)-this.getSum(A-1)}};function w(N,B){var I=N._rawSeries?N._rawSeries:N.series;var W=N.stringMap;var E;var T;if(!N._groupShowBIT){T=N._groupShowBIT=new d(N.stringMapSize);var H=Math.min(10,N.stringMapSize);for(var L=1;L<=10;L++){T.update(L,1)}}else{T=N._groupShowBIT}var M=1/(I.length+1);var K=1-M;var D=[];var J={};var C={};var U=0;var G=0;for(var S=0;S<I.length;S++){var O=I[S];if(!O._showBars){continue}var P={label:O.label,_showBars:O._showBars,_showPoints:O._showPoints,_showLines:O._showLines,color:S+1,data:[]};for(var R=0;R<O.data.length;R++){var Q=O.data[R];var F=Q[0];if(!T.get(F)){continue}var A;if(J[F]===undefined){A=T.getSum(F);C[A]=F;J[F]=A;++U}else{A=J[F]}var V=A+M*S;P.data.push([V,Q[1]])}D.push(P)}N._groupId2RawXMap=C;N._barWidth=M;N._rawSeries=I;N.series=D;if(B){if(!B.xaxis){B.xaxis={}}B.xaxis.min=1-N._barWidth;B.xaxis.max=U+0.9}}function p(A,C){i(C);A.append(c("<h3 class='chart_title'/>").text(C.title)).append(c("<h4 class='chart_subtitle'/>").text(C.subtitle));var B=c("<div class='placeholder'/>").appendTo(A);c("<div class='x_label'/>").text(C.xLabel).appendTo(A);var E=c("<div class='legend'/>").appendTo(A);var D=g(B,E,C);j(B);n(c("<div class='chart_controls_pad'/>").appendTo(A),C)}function f(D,G){var F,H,J,B=D<0,E;if(G.tickSize>=1){F=Math.round(D).toString();E=F.length}else{if(G.tickSize>=0.1){F=D.toFixed(1);E=F.length-2}else{F=D.toFixed(2);E=F.length-3}}var A=B?1:0;H=E-A;if(H<=3){return F}J=B?"-":"";for(var C=A;C<E;++C){J+=F[C];var I=E-1-C;if(I&&!(I%3)){J+=","}}return J+F.substring(E)}function g(I,E,H,D){if(!H.yaxes){H.yaxes=[];H.yaxesMap=[];for(var F=0;F<H.series.length;++F){var M=H.series[F];var J=M._unit&&M._unit.value?M._unit.value:H.yLabel;if(!H.yaxesMap[J]){H.yaxes.push({position:H.yaxes.length&1?"right":"left",axisLabel:J});M.yaxis=H.yaxesMap[J]=H.yaxes.length}else{M.yaxis=H.yaxesMap[J]}}}var L={yaxes:H.yaxes,yaxis:{axisLabel:H.yLabel,minTickSize:0.01,tickFormatter:f},legend:{position:"nw",margin:[0,0],noColumns:5,container:E,labelFormatter:e},selection:{mode:"xy"},series:{lines:{show:true},points:{show:true,radius:1,lineWidth:0,fill:1,fillColor:false}},shadowSize:0,crosshair:{mode:"xy"},grid:{hoverable:true,clickable:true}};var C=H._rawSeries?H._rawSeries:H.series;if(D){L=D(L)}switch(H.xaxisMode){case"TIME":L.xaxis={mode:"time"};break;case"CATEGORIES":var A=[];for(var F=0;F<H.series.length;++F){var B=H.series[F].data[0];B[0]=F;A.push(H.series[F].label)}L.xaxis={minTickSize:1,tickSize:1,tickLength:0,tickFormatter:function(P,O){var N=A[P];if(!N){return""}return"<div class='category_tick'>"+N+"</div>"}};L.series.bars={show:true,align:"center",barWidth:0.8,horizontal:false,lineWidth:0,fill:0.75,fillColor:false};L.series.points.show=false;break;case"BAR_STRING":var K=1/(C.length+1);w(H,L);L.series.lines.show=false;L.series.points.show=false;L.xaxis={min:L.xaxis.min,max:L.xaxis.max,minTickSize:1,tickSize:1,tickLength:0,tickFormatter:function(P,O){var N=H.stringMap[H._groupId2RawXMap[P]];if(!N){return""}return"<div class='category_tick'>"+N+"</div>"},labelWidth:100};L.series.bars={show:true,align:"left",barWidth:H._barWidth,horizontal:false,lineWidth:0,fill:0.8,fillColor:false};break;case"INTEGER":L.xaxis={minTickSize:1,tickSize:1};L.xaxis.tickFormatter=function(P,O){var R=Math.round(P);if(!H.xaxisTicks){return R}if(!H.stringMap){H.stringMap={};for(var Q=0;Q<H.xaxisTicks.length;++Q){H.stringMap[H.xaxisTicks[Q][0]]=H.xaxisTicks[Q][1]}}var N=H.stringMap[R];return N?"<div class='category_tick'>"+N+"</div>":""};break;default:break}var G=c.plot(I,H.series,L);I.data("plot",G);I.data("chart",H);H.plot=G;return G}function n(A,B){c('<input type="button" value="show all"/>').click(function(){m(B,false)}).appendTo(A);c('<input type="button" value="hide all"/>').click(function(){m(B,true)}).appendTo(A)}function m(D,C){for(var B=0;B<D.series.length;++B){var A=D.series[B];if(!A.lines){A.lines={}}A.lines.show=C?false:A.showLines;if(!A.bars){A.bars={}}A.bars.show=C?false:A.showBars;if(!A.points){A.points={}}A.points.show=C?false:A.showPoints;A._show=C?false:true}s(D.plot.getPlaceholder(),D.plot,D,true)}function s(A,D,B,C){if(B){D.setData(B.series)}if(!C){D.setupGrid()}D.draw()}function e(B,C){var A=true;if(C._show===false){A=false}return'<a class="'+(A?"series_label_shown":"series_label_hidden")+'" onclick="ChartGeneration.eventHandlers.toggleSeries(this, '+C._reportIndex+", "+C._chartIndex+", "+C._index+');">'+B+"</a>"}function u(){c(".control_pad").html("");var B=ChartGeneration.compositeReport;B.title="";B._index=-1;if(!B.charts){B.charts=[{title:"Composite Chart",subtitle:"",xaxisMode:"TIME"}]}var D=B.charts[0];D.series=[];D.yaxes=[];D.yaxesMap={};D.xaxisTicks=null;o(c(".report"),B);var A=c(".control_pad");var C=c(".placeholder");c(".chart").addClass("composite_chart");q(C,A)}function r(){var G=c(this);var J=G.data("tag");var D=ChartGeneration.compositeReport.charts[0];var E=D.series;var H=D.yaxesMap;var A=D.yaxes;var I=J.line;var F=I._unit&&I._unit.value?J.chart.yLabel+" ("+I._unit.value+")":J.chart.yLabel;var B=H[F];if(G.is(":checked")){if(!B){A.push({position:A.length&1?"right":"left",axisLabel:F,_used:0});B=H[F]=A.length}++A[B-1]._used;E.push({label:J.chart.subtitle?J.chart.subtitle+"-"+I.label:I.label,data:I.data,yaxis:B,color:J.index});D.xaxisMode=J.chart.xaxisMode;if(D.xaxisMode==="INTEGER"){D.xaxisTicks=J.chart.xaxisTicks}}else{for(var C=0;C<E.length;++C){if(E[C].data===I.data){E.splice(C,1);break}}if(--A[B-1]._used<=0){for(var C=B;C<A.length;++C){A[C].position=A[C].position=="right"?"left":"right";--H[A[C].axisLabel];A[C-1]=A[C]}H[F]=0;A.pop();for(var C=0;C<E.length;++C){if(E[C].yaxis>B){--E[C].yaxis}}}}g(J.$placeholder,J.$legend,D,function(K){K.yaxesMap=H;K.yaxes=A;return K})}function a(){var C=c(this);var A=C.data("$placeholder");var B=ChartGeneration.compositeReport.charts[0];B.series=[];B.yaxes=[];B.yaxesMap={};B.xaxisTicks=null;c(".cb_control_pad").prop("checked",false);s(A,A.data("plot"),B)}function q(N,D){var L=ChartGeneration.data;var F=c("<div/>").appendTo(D);c("<button>Clear Selection</button>").data("$placeholder",N).click(a).appendTo(F);c("<input type='text' placeholder='caption'/>").change(function(){c(".composite_chart .chart_title").text(this.value?this.value:ChartGeneration.compositeReport.title)}).appendTo(F);c("<input type='text' placeholder='description' />").change(function(){c(".composite_chart .chart_subtitle").text(this.value?this.value:ChartGeneration.compositeReport.subtitle)}).appendTo(F);var B=c("<dl/>").appendTo(D);var O=0;for(var J=0;J<L.length;++J){var G=L[J];c("<dt/>").text(G.title).appendTo(B);var K=G.charts;for(var E=0;E<K.length;++E){var M=K[E];if(M.xaxisMode==="CATEGORIES"){continue}if(M.xaxisMode==="INTEGER"){ChartGeneration.compositeReport.xaxisMode=null}var I=c("<dl/>");c("<dd/>").append(I).appendTo(B);c("<dt/>").text(M.title).appendTo(I);var H=M.series;if(!H){continue}for(var C=0;C<H.length;++C){var P=H[C];var A=c("<input type='checkbox' class='cb_control_pad'/>").data("tag",{report:G,chart:M,line:P,$placeholder:N,$legend:N.nextAll(".legend"),index:O++}).change(r);c("<dd/>").append(c("<label/>").text(P.label).prepend(A)).appendTo(I)}}}}function j(A){A.off();A.bind("plotselected",function(G,B){var I=A.data("plot");var C=I.getXAxes();for(var D=0;D<C.length;){var F=C[D++].options;var E=D>1?B["x"+D+"axis"]:B.xaxis;if(!E){continue}if(!F._zoomed){F._min=F.min?F.min:null;F._max=F.max?F.max:null;F._zoomed=true}F.min=E.from;F.max=E.to}var H=I.getYAxes();for(var D=0;D<H.length;){var F=H[D++].options;var E=D>1?B["y"+D+"axis"]:B.yaxis;if(!E){continue}if(!F._zoomed){F._min=F.min?F.min:null;F._max=F.max?F.max:null;F._zoomed=true}F.min=E.from;F.max=E.to}s(A,I,A.data("chart"));I.clearSelection()});A.bind("plothover",function(E,H,D){var C=A.data("chart");if(D){var B;switch(D.series.xaxis.options.mode){case"time":B=new Date(D.datapoint[0]).toUTCString();break;default:B=D.datapoint[0];switch(C.xaxisMode){case"CATEGORIES":B=D.series.label;break;case"BAR_STRING":if(C._groupId2RawXMap&&C.stringMap){B=C.stringMap[C._groupId2RawXMap[Math.floor(B)]]}break;default:if(C.xaxisTicks){var F=v(C.xaxisTicks,B);if(F){B=F}}break}break}var G=D.datapoint[1].toFixed(3);if(D.series._unit&&D.series._unit.value){G+=" "+D.series._unit.value}c("#tooltip").html("<b>"+D.series.label+"</b><br />"+B+"<br />"+G).css({top:D.pageY+5,left:D.pageX+5}).fadeIn(200)}else{c("#tooltip").hide()}});A.bind("dblclick",function(){x(A)});A.bind("plotclick",function(B,I,J){if(J){var H=A.data("chart");var C=H.series[J.seriesIndex];var D=H._interactive=!H._interactive;for(var E=0;E<H.series.length;++E){var F=H.series[E];var G=E!=J.seriesIndex&&D;if(!F.lines){F.lines={}}F.lines.show=G?false:F.showLines;if(!F.bars){F.bars={}}F.bars.show=G?false:F.showBars;if(!F.points){F.points={}}F.points.show=G?false:F.showPoints;F._show=!G}s(H.plot.getPlaceholder(),H.plot,H,true)}})}function v(E,A){var B=0,D=E.length-1;while(B<=D){var C=B+((D-B)>>1);if(E[C][0]==A){return E[C][1]}if(E[C][0]<A){B=C+1}else{D=C-1}}return null}function x(A){var B=A.data("plot");c.each(B.getXAxes(),function(C,D){var E=D.options;if(E._zoomed){E.min=E._min;E.max=E._max;E._zoomed=false}});c.each(B.getYAxes(),function(C,D){var E=D.options;if(E._zoomed){E.min=E._min;E.max=E._max;E._zoomed=false}});s(A,B,null)}function t(){c("<div id='tooltip'></div>").css({position:"absolute",display:"none",border:"1px solid #fdd",padding:"2px","background-color":"#fee",opacity:0.8}).appendTo("body");c("h1").text("Perf-test Report");var D=ChartGeneration.data;var E=c("#report_nav");for(var B=0;B<D.length;++B){var A=D[B];var C=c("<a class='report_switch' href='javascript:'/>").text(A.title).data("report-index",B).click(function(){c(".control_pad").html("");k(c(this).data("report-index"))});E.append(c("<li/>").append(C))}c("<li/>").append(c("<a class='report_switch' href='javascript:'>Composite Chart</a>").click(function(){u()})).appendTo(E)}c(function(){t();k(0)})}ChartGeneration(jQuery);